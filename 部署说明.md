# 🚀 部署说明

## ⚠️ 重要提示

由于项目使用了 Supabase 动态功能（API 路由），现在有**两种部署方式**：

---

## 🌟 方案 A：Vercel 部署（推荐）⭐⭐⭐⭐⭐

### 为什么推荐 Vercel？

- ✅ **支持 SSR**：完整支持 API 路由和动态功能
- ✅ **Supabase 功能完整**：浏览统计、点赞、评论等功能正常工作
- ✅ **自动部署**：Push 到 GitHub 自动构建部署
- ✅ **免费额度**：个人项目免费
- ✅ **速度快**：全球 CDN

### 配置步骤

#### 1. 连接 Vercel

访问 [Vercel](https://vercel.com)，导入你的 GitHub 仓库。

#### 2. 配置环境变量

在 Vercel Dashboard → Settings → Environment Variables 添加：

```
PUBLIC_SUPABASE_URL=https://your-project-id.supabase.co
PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

#### 3. 配置构建命令（可选）

Vercel 会自动检测，无需额外配置。默认使用：
```
构建命令：npm run build:github
输出目录：.vercel/output
```

#### 4. 部署

```bash
git add .
git commit -m "feat: 配置 Vercel 部署"
git push origin main
```

Vercel 会自动构建和部署。

### 当前配置

- ✅ `@astrojs/vercel` adapter 已安装
- ✅ `astro.config.ts` 已配置 Vercel adapter
- ✅ `vercel.json` 已更新输出目录
- ✅ 环境变量需要在 Vercel Dashboard 配置

---

## 📄 方案 B：GitHub Pages 部署（静态模式）

### ⚠️ 限制

GitHub Pages **不支持 SSR**，只能部署静态网站。

**功能限制**：
- ❌ Supabase API 路由不工作
- ❌ 浏览统计功能不可用
- ❌ 点赞功能不可用
- ❌ 评论功能不可用
- ✅ 静态内容正常显示

### 如果仍要使用 GitHub Pages

#### 1. 使用静态配置构建

```bash
npm run build:github
```

这个命令会使用 `astro.config.static.ts`（静态模式），生成纯静态网站。

#### 2. 推送到 GitHub

```bash
git add .
git commit -m "build: GitHub Pages 静态构建"
git push origin main
```

#### 3. 注意事项

- 所有 API 端点（`/api/*`）会返回 404
- 统计组件会显示错误或加载失败
- 建议删除或隐藏统计相关组件

---

## 🎯 推荐部署策略

### 生产环境：Vercel ⭐⭐⭐⭐⭐

```
主域名：your-blog.vercel.app
功能：完整的 Supabase 功能
成本：免费
```

### 备份/测试：GitHub Pages（可选）

```
域名：username.github.io/openeducation
功能：仅静态内容
成本：免费
用途：备份或测试
```

---

## 📊 配置文件说明

### `astro.config.ts`（默认配置）
```typescript
output: 'server'  // SSR 模式
adapter: vercel() // Vercel 适配器
```
- 用于：本地开发、Vercel 部署
- 支持：完整功能

### `astro.config.static.ts`（静态配置）
```typescript
output: 'static'  // 静态模式
// 无 adapter
```
- 用于：GitHub Pages 部署
- 限制：无动态功能

---

## 🚀 快速命令

```bash
# 本地开发（使用 server 模式）
npm run dev

# 构建 Vercel 版本（完整功能）
npm run build:vercel

# 构建 GitHub Pages 版本（静态，无动态功能）
npm run build:github

# 预览构建结果
npm run preview
```

---

## ✅ 部署检查清单

### Vercel 部署前

- [ ] 已安装 `@astrojs/vercel`
- [ ] `astro.config.ts` 配置了 adapter
- [ ] 在 Vercel 配置了环境变量
- [ ] 已连接 GitHub 仓库
- [ ] 推送代码到 main 分支

### GitHub Pages 部署前

- [ ] 理解功能限制（无动态功能）
- [ ] 运行 `npm run build:github`
- [ ] 检查构建输出（dist 目录）
- [ ] 推送到 gh-pages 分支

---

## 🆘 常见问题

### Q1: Vercel 构建失败

**检查**：
- 环境变量是否正确配置
- `@astrojs/vercel` 是否已安装
- 构建日志中的具体错误

**解决**：
```bash
# 本地测试构建
npm run build:vercel
```

### Q2: GitHub Pages 显示 404

**原因**：API 路由不支持

**解决**：
- 使用静态配置构建
- 或切换到 Vercel 部署

### Q3: Supabase 功能不工作

**原因**：
- GitHub Pages 不支持 SSR
- 或环境变量未配置

**解决**：
- 使用 Vercel 部署
- 检查环境变量

---

## 💡 最佳实践

### 推荐配置

```
开发：本地 npm run dev（server 模式）
    ↓
测试：本地 npm run build:vercel
    ↓
部署：推送到 GitHub → Vercel 自动构建
    ↓
生产：Vercel（完整功能）
```

### 不推荐

```
开发：server 模式
    ↓
部署：GitHub Pages（功能缺失）❌
```

---

## 🔗 相关资源

- [Vercel Dashboard](https://vercel.com/dashboard)
- [Astro Vercel Adapter](https://docs.astro.build/en/guides/integrations-guide/vercel/)
- [Astro Server Mode](https://docs.astro.build/en/guides/server-side-rendering/)

---

**建议**：使用 Vercel 部署，享受完整的 Supabase 功能！🚀

