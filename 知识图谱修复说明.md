# çŸ¥è¯†å›¾è°±ä¿®å¤è¯´æ˜

## ğŸ¯ é—®é¢˜

Vercel éƒ¨ç½²çš„ç½‘ç«™ä¸Šï¼ŒçŸ¥è¯†å›¾è°±ï¼ˆGraph Viewï¼‰ä¸æ˜¾ç¤ºï¼Œä½† GitHub Pages ä¸Šæ­£å¸¸ã€‚

## âœ… å·²ä¿®å¤

ä½¿ç”¨ `patch-package` ä¿®å¤äº† `astro-spaceship` ç»„ä»¶çš„ URL æ„å»ºé€»è¾‘ã€‚

---

## ğŸ“¦ ä¿®å¤å†…å®¹

### 1. ä¿®æ”¹çš„æ–‡ä»¶

- âœ… `node_modules/astro-spaceship/components/GraphView/GraphView.astro`
- âœ… `patches/astro-spaceship+0.9.8.patch`ï¼ˆè¡¥ä¸æ–‡ä»¶ï¼‰
- âœ… `package.json`ï¼ˆæ·»åŠ  postinstall è„šæœ¬ï¼‰

### 2. ä¿®å¤é€»è¾‘

**åŸä»£ç é—®é¢˜**ï¼ˆç¬¬ 57 è¡Œï¼‰ï¼š
```javascript
const url = base ? `/${base.replace(/^\/+|\/+$/g, '')}/_spaceship/graph/${slug ?? "index"}.json` : `/_spaceship/graph/${slug ?? "index"}.json`;
```

å½“ `base="/"` æ—¶ï¼ŒURL æ„å»ºæœ‰é—®é¢˜ã€‚

**ä¿®å¤å**ï¼š
```javascript
// ä¿®å¤ï¼šå¤„ç†æ ¹è·¯å¾„ "/" çš„æƒ…å†µï¼Œç¡®ä¿URLæ­£ç¡®æ„å»º
let basePath = base ? base.replace(/^\/+|\/+$/g, '') : '';
const url = basePath ? `/${basePath}/_spaceship/graph/${slug ?? "index"}.json` : `/_spaceship/graph/${slug ?? "index"}.json`;
```

---

## ğŸš€ éƒ¨ç½²åˆ° GitHub & Vercel

### æ­¥éª¤ 1ï¼šæäº¤æ›´æ”¹

```bash
cd F:\IOTO-Doc\AstrOb

# æŸ¥çœ‹ä¿®æ”¹å†…å®¹
git status

# æ·»åŠ ä¿®æ”¹çš„æ–‡ä»¶
git add patches/astro-spaceship+0.9.8.patch
git add package.json

# æäº¤ï¼ˆä½¿ç”¨ä¸­æ–‡æäº¤ä¿¡æ¯ï¼‰
git commit -m "ä¿®å¤çŸ¥è¯†å›¾è°±åœ¨Vercelä¸Šä¸æ˜¾ç¤ºçš„é—®é¢˜

- ä½¿ç”¨patch-packageä¿®å¤GraphViewç»„ä»¶URLæ„å»ºé€»è¾‘
- æ·»åŠ postinstallè„šæœ¬è‡ªåŠ¨åº”ç”¨è¡¥ä¸
- ä¿®å¤å½“baseä¸ºæ ¹è·¯å¾„æ—¶çš„URLè§£æé—®é¢˜"

# æ¨é€åˆ° GitHub
git push origin main
```

### æ­¥éª¤ 2ï¼šéªŒè¯éƒ¨ç½²

**GitHub Pages**ï¼ˆè‡ªåŠ¨éƒ¨ç½²ï¼‰ï¼š
- è®¿é—®ï¼šhttps://xujinhuana.github.io/openeducation/obsidian-test
- æ£€æŸ¥ Actions æ ‡ç­¾é¡µæŸ¥çœ‹æ„å»ºçŠ¶æ€

**Vercel**ï¼ˆè‡ªåŠ¨éƒ¨ç½²ï¼‰ï¼š
- è®¿é—®ï¼šhttps://openeducation.vercel.app/obsidian-test
- æˆ–è®¿é—® Vercel Dashboard æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—

### æ­¥éª¤ 3ï¼šæµ‹è¯•çŸ¥è¯†å›¾è°±

1. æ‰“å¼€ä»»æ„ç¬”è®°é¡µé¢
2. ç‚¹å‡»å³ä¾§è¾¹æ çš„ **"Graph"** æ ‡ç­¾
3. âœ… åº”è¯¥æ˜¾ç¤ºçŸ¥è¯†å›¾è°±èŠ‚ç‚¹å’Œè¿æ¥çº¿
4. ğŸ” æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼Œç¡®è®¤æ²¡æœ‰é”™è¯¯

---

## ğŸ§ª æœ¬åœ°æµ‹è¯•

å¦‚æœæƒ³åœ¨æœ¬åœ°æµ‹è¯•ä¿®å¤ï¼š

```bash
cd F:\IOTO-Doc\AstrOb

# é‡æ–°å®‰è£…ä¾èµ–ï¼ˆä¼šè‡ªåŠ¨åº”ç”¨è¡¥ä¸ï¼‰
npm install

# æ„å»ºé¡¹ç›®
npm run build:github

# é¢„è§ˆ
npm run preview
```

---

## ğŸ“‹ æŠ€æœ¯ç»†èŠ‚

### patch-package å·¥ä½œæµç¨‹

1. **ä¿®æ”¹**ï¼šç›´æ¥ä¿®æ”¹ `node_modules` ä¸­çš„æ–‡ä»¶
2. **ç”Ÿæˆè¡¥ä¸**ï¼š`npx patch-package astro-spaceship`
3. **åº”ç”¨è¡¥ä¸**ï¼š`npm install` æ—¶è‡ªåŠ¨åº”ç”¨ï¼ˆé€šè¿‡ `postinstall` è„šæœ¬ï¼‰

### è¡¥ä¸æ–‡ä»¶ä½ç½®

```
AstrOb/
â”œâ”€â”€ patches/
â”‚   â””â”€â”€ astro-spaceship+0.9.8.patch  â† è¡¥ä¸æ–‡ä»¶
â”œâ”€â”€ package.json                     â† åŒ…å« postinstall è„šæœ¬
â””â”€â”€ node_modules/                    â† ä¿®æ”¹ä¼šè¢«åº”ç”¨åˆ°è¿™é‡Œ
```

### ä¸ºä»€ä¹ˆéœ€è¦è¡¥ä¸ï¼Ÿ

- `astro-spaceship` çš„ GraphView ç»„ä»¶åœ¨ `base="/"` æ—¶ URL æ„å»ºæœ‰ bug
- è¡¥ä¸æ–‡ä»¶ä¼šåœ¨æ¯æ¬¡ `npm install` åè‡ªåŠ¨åº”ç”¨
- Vercel å’Œ GitHub Actions éƒ¨ç½²æ—¶éƒ½ä¼šè‡ªåŠ¨åº”ç”¨

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ä¸è¦æ‰‹åŠ¨ç¼–è¾‘è¡¥ä¸æ–‡ä»¶

å¦‚æœéœ€è¦ä¿®æ”¹ï¼Œåº”è¯¥ï¼š
```bash
# 1. ä¿®æ”¹ node_modules ä¸­çš„æºæ–‡ä»¶
# 2. é‡æ–°ç”Ÿæˆè¡¥ä¸
npx patch-package astro-spaceship --exclude "nothing"
```

### 2. å‡çº§ astro-spaceship æ—¶

å¦‚æœå‡çº§äº† `astro-spaceship` åˆ°æ–°ç‰ˆæœ¬ï¼š
```bash
# æ£€æŸ¥è¡¥ä¸æ˜¯å¦è¿˜èƒ½åº”ç”¨
npm install

# å¦‚æœå¤±è´¥ï¼Œéœ€è¦é‡æ–°åˆ›å»ºè¡¥ä¸
# 1. åˆ é™¤æ—§è¡¥ä¸
rm patches/astro-spaceship+*.patch

# 2. ä¿®æ”¹æ–°ç‰ˆæœ¬çš„æ–‡ä»¶
# 3. é‡æ–°ç”Ÿæˆè¡¥ä¸
npx patch-package astro-spaceship --exclude "nothing"
```

### 3. CI/CD è‡ªåŠ¨éƒ¨ç½²

GitHub Actions å’Œ Vercel éƒ½ä¼šï¼š
- âœ… è‡ªåŠ¨è¿è¡Œ `npm install`
- âœ… è‡ªåŠ¨æ‰§è¡Œ `postinstall` è„šæœ¬
- âœ… è‡ªåŠ¨åº”ç”¨è¡¥ä¸

æ‰€ä»¥åªéœ€æ¨é€ä»£ç å³å¯ã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [VercelçŸ¥è¯†å›¾è°±æ˜¾ç¤ºé—®é¢˜åˆ†æ](../4-Outcome/æ—¥å¸¸å·¥ä½œ/æ€»ç»“/VercelçŸ¥è¯†å›¾è°±æ˜¾ç¤ºé—®é¢˜åˆ†æ.md) - è¯¦ç»†çš„é—®é¢˜åˆ†æ
- [éƒ¨ç½²å¿«é€Ÿå‚è€ƒ](./éƒ¨ç½²å¿«é€Ÿå‚è€ƒ.md) - éƒ¨ç½²å‘½ä»¤å’Œé…ç½®
- [éƒ¨ç½²é…ç½®æŒ‡å—](./éƒ¨ç½²é…ç½®æŒ‡å—.md) - å®Œæ•´çš„éƒ¨ç½²æŒ‡å—

---

## ğŸ”— åœ¨çº¿æ¼”ç¤º

- **GitHub Pages**ï¼šhttps://xujinhuana.github.io/openeducation/obsidian-test
- **Vercel**ï¼šhttps://openeducation.vercel.app/obsidian-test

ä¸¤ä¸ªå¹³å°çš„çŸ¥è¯†å›¾è°±ç°åœ¨åº”è¯¥éƒ½èƒ½æ­£å¸¸æ˜¾ç¤ºï¼âœ¨

---

**åˆ›å»ºæ—¥æœŸ**ï¼š2024-10-22  
**ä½œè€…**ï¼šAI Assistant  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆå¹¶æµ‹è¯•

