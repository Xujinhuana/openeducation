# 📝 AstrOb 配置说明

## 🎯 当前配置（简化版）

### 统一 base 路径
本地开发和 GitHub Pages 现在使用**相同的 base 路径**：`/openeducation/`

✅ **优点**：
- 简单：无需环境检测
- 一致：本地和生产环境行为完全相同
- 易维护：减少配置复杂度

---

## 🚀 快速启动

### 本地开发
```bash
# 方法 1：双击运行（推荐）
dev-local.bat

# 方法 2：命令行
cd /d F:\IOTO-Doc\AstrOb
set PWD=%CD%
set SPACESHIP_AUTHOR=My Vault
npm run dev
```

**访问地址**：`http://localhost:4321/openeducation/`

---

### GitHub Pages 部署
```bash
git add .
git commit -m "Update content"
git push origin main
```

**访问地址**：`https://your-username.github.io/openeducation/`

---

## ⚙️ 配置文件说明

### astro.config.ts（已简化）
```typescript
export default defineConfig({
  site: process.env.SPACESHIP_SITE || 'http://localhost:4321',
  base: process.env.SPACESHIP_BASE || '/openeducation/'
});
```

**逻辑**：
- 默认使用 `/openeducation/` 作为 base
- 可通过环境变量覆盖（用于 Vercel 等其他平台）

---

### website.config.json
```json
{
  "title": "首页",
  "description": "Ship your Second Brain into the Cyber-Space",
  "author": "My Vault",
  "defaultLocale": "en"
}
```

**注意**：不要在这里设置 `base`，由 `astro.config.ts` 统一管理。

---

### dev-local.bat（本地开发脚本）
```batch
set PWD=%CD%
set SPACESHIP_AUTHOR=My Vault
npm run dev
```

**作用**：设置必需的环境变量并启动开发服务器。

---

## 🔧 环境变量

### 必需变量

| 变量 | 值 | 说明 |
|------|------|------|
| `PWD` | 项目路径 | Windows 下 varlock 必需 |
| `SPACESHIP_AUTHOR` | `My Vault` | 作者信息 |

### 可选变量（覆盖默认值）

| 变量 | 默认值 | 说明 |
|------|---------|------|
| `SPACESHIP_BASE` | `/openeducation/` | base 路径 |
| `SPACESHIP_SITE` | `http://localhost:4321` | 网站地址 |

---

## 🌐 不同平台部署

### GitHub Pages
使用默认配置即可，无需额外设置。

**workflow 配置**：
```yaml
env:
  SPACESHIP_AUTHOR: My Vault
  # base 使用默认值 /openeducation/
```

---

### Vercel
需要自定义 base 为根路径。

**vercel.json**：
```json
{
  "env": {
    "SPACESHIP_BASE": "/",
    "SPACESHIP_AUTHOR": "My Vault"
  }
}
```

或在 Vercel Dashboard 设置环境变量。

---

## 📋 核心文件清单

| 文件 | 作用 | 状态 |
|------|------|------|
| `astro.config.ts` | Astro 主配置 | ✅ 已简化 |
| `website.config.json` | 网站基础信息 | ✅ 配置完成 |
| `dev-local.bat` | 本地开发启动 | ✅ 配置完成 |
| `vercel.json` | Vercel 部署配置 | ✅ 配置完成 |
| `node_modules/.../get-static-paths.ts` | Windows 路径修复 | ⚠️ 需手动维护 |

---

## ⚠️ 注意事项

### 1. Windows 路径修复会在重装依赖后丢失
**影响**：运行 `npm install` 后需要重新修改。

**解决**：每次重装后手动修改以下文件：
```
node_modules/astro-spaceship/components/Article/utils/get-static-paths.ts
```

第 4 行改为：
```typescript
import { join } from "node:path/posix";
```

第 132-134 行改为：
```typescript
const authors = (await getCollection(authorsCollection as any)) as Author[];
const documents = (await getCollection(documentsCollection as any)) as Document[];
const tags = (await getCollection(tagsCollection as any)) as Tag[];
```

---

### 2. 端口冲突
如果显示 `Port 4321 is in use`，会自动使用 4322 或其他端口。

**访问**：查看终端输出的实际端口号。

---

### 3. 缓存问题
遇到奇怪问题时，清理缓存：
```bash
rmdir /s /q .astro
rmdir /s /q node_modules\.cache
```

---

## 🎯 总结

### 当前配置策略
- **本地和 GitHub Pages**：统一使用 `/openeducation/`
- **Vercel**：使用 `/`（通过环境变量覆盖）
- **简单明了**：减少了环境检测逻辑

### 访问地址
- **本地**：`http://localhost:4321/openeducation/`
- **GitHub**：`https://username.github.io/openeducation/`
- **Vercel**：`https://project.vercel.app/`

---

**最后更新**：2025-10-21  
**配置状态**：✅ 已完成并简化

