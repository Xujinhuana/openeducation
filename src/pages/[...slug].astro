---
import { getStaticPathsFactory, type Props } from "astro-spaceship/components/Article/utils/get-static-paths.ts";
import Page from 'astro-spaceship/components/Article/Page.astro';
import ThemeToggle from '@/components/ThemeToggle.astro';
import ThemeSelector from '@/components/ThemeSelector.astro';

import '@/styles/global.css';
import config from 'astro-spaceship/config';


export type { Props };

// 🔥 关键：在 server 模式下，让这个页面预渲染为静态 HTML
export const prerender = true;

export const getStaticPaths = getStaticPathsFactory({
  config,
});

---

<Page {...Astro.props}>
  <Fragment slot="head">
    <!-- 引入 Alpine.js -->
    <script>
      import Alpine from 'alpinejs';
      window.Alpine = Alpine;
      Alpine.start();
    </script>
    
    <!-- 主题初始化脚本（防止闪烁） -->
    <script is:inline>
      // 在页面加载前立即执行，防止主题和颜色模式闪烁
      (function() {
        // 初始化颜色模式（亮色/暗色）
        const colorMode = localStorage.getItem('colorMode') || 
          (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
        
        if (colorMode === 'dark') {
          document.documentElement.classList.add('dark');
          document.documentElement.classList.remove('light');
        } else {
          document.documentElement.classList.remove('dark');
          document.documentElement.classList.add('light');
        }
        
        // 初始化主题
        const theme = localStorage.getItem('selectedTheme') || 'default';
        document.documentElement.setAttribute('data-active-theme', theme);
      })();
    </script>
    
    <!-- 注入文章统计组件 -->
    <script>
      import '@/scripts/inject-article-stats.ts';
    </script>
  </Fragment>
</Page>
<ThemeToggle />
<ThemeSelector />
