---
// ä¸»é¢˜é€‰æ‹©å™¨ - ç®€å•çš„ä¸‹æ‹‰èœå•
---

<div class="theme-selector">
  <button class="theme-selector-btn" id="theme-selector-btn" aria-label="é€‰æ‹©ä¸»é¢˜">
    <span class="theme-icon">ğŸ¨</span>
    <span class="theme-label" id="current-theme-label">ä¸»é¢˜</span>
    <span class="theme-arrow">â–¼</span>
  </button>
  
  <div class="theme-dropdown" id="theme-dropdown">
    <button class="theme-option" data-theme="default">
      <span class="option-icon">ğŸ¨</span>
      <span class="option-text">Default ä¸»é¢˜</span>
    </button>
    
    <button class="theme-option" data-theme="framer">
      <span class="option-icon">ğŸ–¼ï¸</span>
      <span class="option-text">Framer ä¸»é¢˜</span>
    </button>
    
    <button class="theme-option" data-theme="galaxy">
      <span class="option-icon">ğŸŒ </span>
      <span class="option-text">Galaxy ä¸»é¢˜</span>
    </button>
    
    <button class="theme-option" data-theme="journey">
      <span class="option-icon">âœˆï¸</span>
      <span class="option-text">Journey ä¸»é¢˜</span>
    </button>
    
    <button class="theme-option" data-theme="temple">
      <span class="option-icon">ğŸ›ï¸</span>
      <span class="option-text">Temple ä¸»é¢˜</span>
    </button>
  </div>
</div>

<style>
  /* ä¸»é¢˜é€‰æ‹©å™¨å®¹å™¨ */
  .theme-selector {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
  }

  /* ä¸»æŒ‰é’® */
  .theme-selector-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: var(--theme-bg-elevated, #152a3d);
    color: var(--theme-text-primary, #e2e8f0);
    border: 1px solid var(--theme-border-light, rgba(255, 255, 255, 0.1));
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .theme-selector-btn:hover {
    background: var(--theme-bg-main, #071827);
    border-color: var(--theme-primary, #06b6d4);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .theme-icon {
    font-size: 18px;
    line-height: 1;
  }

  .theme-label {
    min-width: 80px;
    text-align: left;
  }

  .theme-arrow {
    font-size: 10px;
    transition: transform 0.2s ease;
  }

  .theme-selector-btn.open .theme-arrow {
    transform: rotate(180deg);
  }

  /* ä¸‹æ‹‰èœå• */
  .theme-dropdown {
    position: absolute;
    bottom: calc(100% + 8px);
    right: 0;
    min-width: 180px;
    background: var(--theme-bg-elevated, #152a3d);
    border: 1px solid var(--theme-border-light, rgba(255, 255, 255, 0.1));
    border-radius: 8px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s ease;
    overflow: hidden;
  }

  .theme-dropdown.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  /* ä¸»é¢˜é€‰é¡¹ */
  .theme-option {
    display: flex;
    align-items: center;
    gap: 12px;
    width: 100%;
    padding: 12px 16px;
    background: transparent;
    color: var(--theme-text-primary, #e2e8f0);
    border: none;
    font-size: 14px;
    text-align: left;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .theme-option:hover {
    background: var(--theme-bg-main, #071827);
    color: var(--theme-primary, #06b6d4);
  }

  .theme-option.active {
    background: var(--theme-primary, #06b6d4);
    color: white;
  }

  .theme-option.active .option-icon {
    transform: scale(1.2);
  }

  .option-icon {
    font-size: 18px;
    line-height: 1;
    transition: transform 0.2s ease;
  }

  .option-text {
    flex: 1;
  }

  /* ç§»åŠ¨ç«¯é€‚é… */
  @media (max-width: 768px) {
    .theme-selector {
      bottom: 80px;
      right: 15px;
    }

    .theme-selector-btn {
      padding: 8px 12px;
      font-size: 13px;
    }

    .theme-label {
      min-width: 60px;
    }

    .theme-dropdown {
      min-width: 160px;
    }

    .theme-option {
      padding: 10px 14px;
      font-size: 13px;
    }
  }

  /* åœ¨å°å±å¹•ä¸Šéšè—æ–‡å­—ï¼Œåªæ˜¾ç¤ºå›¾æ ‡ */
  @media (max-width: 480px) {
    .theme-label,
    .theme-arrow {
      display: none;
    }

    .theme-selector-btn {
      padding: 10px;
    }
  }
</style>

<script is:inline>
  (function() {
    const btn = document.getElementById('theme-selector-btn');
    const dropdown = document.getElementById('theme-dropdown');
    const label = document.getElementById('current-theme-label');
    const options = document.querySelectorAll('.theme-option');

    // åŠ¨æ€åŠ è½½ä¸»é¢˜ CSS æ–‡ä»¶
    let currentThemeLink = null;
    
    function loadThemeCSS(themeName) {
      // ç§»é™¤ä¹‹å‰åŠ è½½çš„ä¸»é¢˜æ–‡ä»¶
      if (currentThemeLink) {
        currentThemeLink.remove();
        currentThemeLink = null;
      }
      
      // æ ¹æ®ä¸»é¢˜åç§°ç¡®å®šæ˜¯å¦éœ€è¦åŠ è½½é¢å¤–çš„ CSS æ–‡ä»¶
      // é»˜è®¤ä¸»é¢˜å·²ç»åœ¨ global.css ä¸­åŠ è½½ï¼Œä¸éœ€è¦é¢å¤–åŠ è½½
      const themeFiles = {
        'framer': 'theme.framer.css',
        'galaxy': 'theme.galaxy.css',
        'journey': 'theme.journey.css',
        'temple': 'theme.temple.css'
      };
      
      const fileName = themeFiles[themeName];
      if (fileName) {
        // åˆ›å»ºä¸€ä¸ª style æ ‡ç­¾åŠ¨æ€å¯¼å…¥ä¸»é¢˜
        const style = document.createElement('style');
        style.id = 'dynamic-theme-css';
        style.textContent = '@import url("/openeducation/src/styles/' + fileName + '");';
        document.head.appendChild(style);
        currentThemeLink = style;
      }
    }

    // è·å–å½“å‰æ˜æš—æ¨¡å¼çŠ¶æ€
    function getCurrentColorMode() {
      // ä¼˜å…ˆä» localStorage è¯»å–ç”¨æˆ·åå¥½
      const saved = localStorage.getItem('colorMode');
      if (saved === 'dark' || saved === 'light') {
        return saved;
      }
      // å…¶æ¬¡æ£€æŸ¥å½“å‰ DOM çŠ¶æ€
      if (document.documentElement.classList.contains('dark')) {
        return 'dark';
      }
      // æœ€åä½¿ç”¨ç³»ç»Ÿåå¥½
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        return 'dark';
      }
      return 'light';
    }

    // åº”ç”¨æ˜æš—æ¨¡å¼ï¼ˆç”± ThemeToggle å’Œä¸»é¢˜åˆ‡æ¢å…±ç”¨ï¼‰
    function applyColorMode(mode) {
      if (mode === 'dark') {
        document.documentElement.classList.add('dark');
        document.documentElement.classList.remove('light');
      } else {
        document.documentElement.classList.remove('dark');
        document.documentElement.classList.add('light');
      }
      localStorage.setItem('colorMode', mode);
    }

    // ä¸»é¢˜é…ç½®ï¼ˆåªä¿ç•™ä¸»é¢˜é£æ ¼ï¼Œä¸åŒ…å«æ˜æš—å˜ä½“ï¼‰
    const themes = {
      'default': {
        name: 'Default ä¸»é¢˜',
        icon: 'ğŸ¨',
        themeFile: 'default',
        apply: function() {
          loadThemeCSS('default');
          // ä¿æŒå½“å‰æ˜æš—æ¨¡å¼
          const currentMode = getCurrentColorMode();
          applyColorMode(currentMode);
          document.documentElement.removeAttribute('data-theme');
          document.body.classList.remove('framer-theme', 'framer-typography');
          document.body.style.background = '';
          document.body.style.color = '';
        }
      },
      'framer': {
        name: 'Framer ä¸»é¢˜',
        icon: 'ğŸ–¼ï¸',
        themeFile: 'framer',
        apply: function() {
          loadThemeCSS('framer');
          // ä¿æŒå½“å‰æ˜æš—æ¨¡å¼
          const currentMode = getCurrentColorMode();
          if (currentMode === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
          } else {
            document.documentElement.removeAttribute('data-theme');
          }
          applyColorMode(currentMode);
          document.body.classList.add('framer-theme', 'framer-typography');
          document.body.style.background = 'var(--framer-bg)';
          document.body.style.color = 'var(--framer-text)';
        }
      },
      'galaxy': {
        name: 'Galaxy ä¸»é¢˜',
        icon: 'ğŸŒ ',
        themeFile: 'galaxy',
        apply: function() {
          loadThemeCSS('galaxy');
          // ä¿æŒå½“å‰æ˜æš—æ¨¡å¼
          const currentMode = getCurrentColorMode();
          applyColorMode(currentMode);
          document.documentElement.removeAttribute('data-theme');
          document.body.classList.remove('framer-theme', 'framer-typography');
          document.body.style.background = '';
          document.body.style.color = '';
        }
      },
      'journey': {
        name: 'Journey ä¸»é¢˜',
        icon: 'âœˆï¸',
        themeFile: 'journey',
        apply: function() {
          loadThemeCSS('journey');
          // ä¿æŒå½“å‰æ˜æš—æ¨¡å¼
          const currentMode = getCurrentColorMode();
          applyColorMode(currentMode);
          document.documentElement.removeAttribute('data-theme');
          document.body.classList.remove('framer-theme', 'framer-typography');
          document.body.style.background = '';
          document.body.style.color = '';
        }
      },
      'temple': {
        name: 'Temple ä¸»é¢˜',
        icon: 'ğŸ›ï¸',
        themeFile: 'temple',
        apply: function() {
          loadThemeCSS('temple');
          // ä¿æŒå½“å‰æ˜æš—æ¨¡å¼
          const currentMode = getCurrentColorMode();
          applyColorMode(currentMode);
          document.documentElement.removeAttribute('data-theme');
          document.body.classList.remove('framer-theme', 'framer-typography');
          document.body.style.background = '';
          document.body.style.color = '';
        }
      }
    };

    // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
    function loadTheme() {
      const saved = localStorage.getItem('selectedTheme') || 'default';
      applyTheme(saved);
    }

    // åº”ç”¨ä¸»é¢˜
    function applyTheme(themeId) {
      const theme = themes[themeId];
      if (!theme) return;

      // åº”ç”¨ä¸»é¢˜
      theme.apply();

      // æ›´æ–°æŒ‰é’®æ–‡å­—
      label.textContent = theme.name;

      // æ›´æ–°é€‰é¡¹çŠ¶æ€
      options.forEach(function(opt) {
        if (opt.getAttribute('data-theme') === themeId) {
          opt.classList.add('active');
        } else {
          opt.classList.remove('active');
        }
      });

      // ä¿å­˜é€‰æ‹©
      localStorage.setItem('selectedTheme', themeId);
    }

    // åˆ‡æ¢ä¸‹æ‹‰èœå•
    btn?.addEventListener('click', function() {
      const isOpen = dropdown.classList.contains('show');
      if (isOpen) {
        dropdown.classList.remove('show');
        btn.classList.remove('open');
      } else {
        dropdown.classList.add('show');
        btn.classList.add('open');
      }
    });

    // ç‚¹å‡»é€‰é¡¹
    options.forEach(function(option) {
      option.addEventListener('click', function(e) {
        e.stopPropagation();
        const themeId = this.getAttribute('data-theme');
        applyTheme(themeId);
        dropdown.classList.remove('show');
        btn.classList.remove('open');
      });
    });

    // ç‚¹å‡»å¤–éƒ¨å…³é—­
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.theme-selector')) {
        dropdown.classList.remove('show');
        btn?.classList.remove('open');
      }
    });

    // åˆå§‹åŒ–
    loadTheme();
  })();
</script>

