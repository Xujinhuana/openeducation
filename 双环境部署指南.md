# ğŸš€ åŒç¯å¢ƒéƒ¨ç½²æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®æ”¯æŒåŒæ—¶éƒ¨ç½²åˆ°ä¸¤ä¸ªå¹³å°ï¼š
- **GitHub Pages**ï¼šçº¯é™æ€å†…å®¹ï¼Œæ—  Supabase åŠŸèƒ½
- **Vercel**ï¼šå®Œæ•´åŠŸèƒ½ï¼ŒåŒ…å« Supabase äº¤äº’

é€šè¿‡ç¯å¢ƒå˜é‡ `PUBLIC_ENABLE_SUPABASE` è‡ªåŠ¨åˆ‡æ¢åŠŸèƒ½ã€‚

---

## ğŸ¯ åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | GitHub Pages | Vercel |
|------|--------------|--------|
| **æ–‡ç« å†…å®¹** | âœ… | âœ… |
| **é¡µé¢å¯¼èˆª** | âœ… | âœ… |
| **ä¸»é¢˜åˆ‡æ¢** | âœ… | âœ… |
| **æµè§ˆé‡ç»Ÿè®¡** | âŒ | âœ… |
| **ç‚¹èµåŠŸèƒ½** | âŒ | âœ… |
| **è¯„è®ºç³»ç»Ÿ** | âŒ | âœ… |
| **API è·¯ç”±** | âŒ | âœ… |
| **Supabase** | âŒ | âœ… |

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

#### `PUBLIC_ENABLE_SUPABASE`

**ä½œç”¨**ï¼šæ§åˆ¶æ˜¯å¦å¯ç”¨ Supabase ç›¸å…³åŠŸèƒ½

**å¯é€‰å€¼**ï¼š
- `'true'` - å¯ç”¨ Supabase åŠŸèƒ½ï¼ˆVercel éƒ¨ç½²ï¼‰
- `'false'` - ç¦ç”¨ Supabase åŠŸèƒ½ï¼ˆGitHub Pages éƒ¨ç½²ï¼‰

**å½±å“èŒƒå›´**ï¼š
- æ–‡ç« æµè§ˆé‡ç»Ÿè®¡æ˜¾ç¤º
- API è·¯ç”±è°ƒç”¨
- ç»Ÿè®¡ç»„ä»¶æ³¨å…¥
- ç‚¹èµæŒ‰é’®æ˜¾ç¤º
- è¯„è®ºåŠŸèƒ½æ˜¾ç¤º

---

## ğŸš€ éƒ¨ç½²é…ç½®

### æ–¹æ¡ˆ 1ï¼šGitHub Pages éƒ¨ç½²ï¼ˆçº¯é™æ€ï¼‰

#### è‡ªåŠ¨éƒ¨ç½²é…ç½®

å·²åœ¨ `.github/workflows/deploy.yml` ä¸­é…ç½®ï¼š

```yaml
- name: Build with Astro (Static for GitHub Pages)
  run: npm run build:github
  env:
    SPACESHIP_SITE: https://xujinhuana.github.io
    SPACESHIP_BASE: /openeducation/
    SPACESHIP_AUTHOR: My Vault
    PUBLIC_ENABLE_SUPABASE: 'false'  # â† ç¦ç”¨ Supabase
```

#### æ„å»ºé…ç½®

- **é…ç½®æ–‡ä»¶**ï¼š`astro.config.static.ts`
- **æ¨¡å¼**ï¼š`static`
- **è¾“å‡ºç›®å½•**ï¼š`dist/`
- **æ„å»ºå‘½ä»¤**ï¼š`npm run build:github`

#### éƒ¨ç½²ç»“æœ

è®¿é—® `https://xujinhuana.github.io/openeducation/`ï¼š
- âœ… æ‰€æœ‰æ–‡ç« æ­£å¸¸æ˜¾ç¤º
- âœ… å¯¼èˆªã€æ ·å¼ã€ä¸»é¢˜æ­£å¸¸
- âŒ ä¸æ˜¾ç¤ºæµè§ˆé‡ç»Ÿè®¡
- âŒ ä¸æ˜¾ç¤ºç‚¹èµæŒ‰é’®
- âŒ æµè§ˆå™¨æ§åˆ¶å°æ—  API é”™è¯¯

---

### æ–¹æ¡ˆ 2ï¼šVercel éƒ¨ç½²ï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰

#### Vercel ç¯å¢ƒå˜é‡é…ç½®

åœ¨ Vercel Dashboard â†’ Settings â†’ Environment Variables æ·»åŠ ï¼š

```
PUBLIC_ENABLE_SUPABASE=true
PUBLIC_SUPABASE_URL=https://your-project-id.supabase.co
PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here
```

#### æ„å»ºé…ç½®

- **é…ç½®æ–‡ä»¶**ï¼š`astro.config.ts`
- **æ¨¡å¼**ï¼š`server`
- **Adapter**ï¼š`@astrojs/vercel`
- **è¾“å‡ºç›®å½•**ï¼š`.vercel/output/`
- **æ„å»ºå‘½ä»¤**ï¼š`npm run build:vercel`

#### éƒ¨ç½²ç»“æœ

è®¿é—® `https://your-project.vercel.app/openeducation/`ï¼š
- âœ… æ‰€æœ‰æ–‡ç« æ­£å¸¸æ˜¾ç¤º
- âœ… å¯¼èˆªã€æ ·å¼ã€ä¸»é¢˜æ­£å¸¸
- âœ… æ˜¾ç¤ºæµè§ˆé‡ç»Ÿè®¡
- âœ… æ˜¾ç¤ºç‚¹èµæŒ‰é’®
- âœ… æ‰€æœ‰ Supabase åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

## ğŸ› ï¸ æœ¬åœ°å¼€å‘

### æ­¥éª¤ 1ï¼šåˆ›å»º .env æ–‡ä»¶

```bash
# å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
cp .env.example .env
```

### æ­¥éª¤ 2ï¼šé…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
# å¯ç”¨ Supabase åŠŸèƒ½
PUBLIC_ENABLE_SUPABASE=true

# Supabase é…ç½®
PUBLIC_SUPABASE_URL=https://your-project-id.supabase.co
PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

### æ­¥éª¤ 3ï¼šå¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### æµ‹è¯•ä¸åŒç¯å¢ƒ

**æµ‹è¯• Vercel æ¨¡å¼ï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰**ï¼š
```bash
# .env ä¸­è®¾ç½®
PUBLIC_ENABLE_SUPABASE=true

# å¯åŠ¨
npm run dev
```

**æµ‹è¯• GitHub Pages æ¨¡å¼ï¼ˆçº¯é™æ€ï¼‰**ï¼š
```bash
# .env ä¸­è®¾ç½®
PUBLIC_ENABLE_SUPABASE=false

# æ„å»º
npm run build:github

# é¢„è§ˆ
npm run preview
```

---

## ğŸ“‚ æ–‡ä»¶è¯´æ˜

### ä¿®æ”¹çš„æ–‡ä»¶

#### 1. `src/components/ArticleStats.astro`
```astro
---
// æ£€æŸ¥æ˜¯å¦å¯ç”¨ Supabase
const enableSupabase = import.meta.env.PUBLIC_ENABLE_SUPABASE === 'true';
---

{enableSupabase ? (
  <!-- æ˜¾ç¤ºç»Ÿè®¡ -->
) : (
  <!-- ä¸æ˜¾ç¤ºç»Ÿè®¡ -->
)}
```

#### 2. `src/scripts/inject-article-stats.ts`
```typescript
// æ£€æŸ¥ç¯å¢ƒå˜é‡
const enableSupabase = import.meta.env.PUBLIC_ENABLE_SUPABASE === 'true';

if (!enableSupabase) {
  // ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
} else {
  // æ³¨å…¥ç»Ÿè®¡ç»„ä»¶
}
```

#### 3. `src/pages/[...slug].astro`
```astro
<!-- æ¡ä»¶æ³¨å…¥ç»Ÿè®¡è„šæœ¬ -->
{import.meta.env.PUBLIC_ENABLE_SUPABASE === 'true' && (
  <script>
    import '@/scripts/inject-article-stats.ts';
  </script>
)}
```

#### 4. `.github/workflows/deploy.yml`
```yaml
env:
  PUBLIC_ENABLE_SUPABASE: 'false'  # GitHub Pages ç¦ç”¨
```

---

## âœ… éªŒè¯æ¸…å•

### GitHub Pages éƒ¨ç½²éªŒè¯

- [ ] æ¨é€ä»£ç åˆ° GitHub
- [ ] GitHub Actions æ„å»ºæˆåŠŸ
- [ ] è®¿é—® `https://xujinhuana.github.io/openeducation/`
- [ ] æ–‡ç« å†…å®¹æ­£å¸¸æ˜¾ç¤º
- [ ] é¡µé¢æ ·å¼æ­£å¸¸
- [ ] **ä¸æ˜¾ç¤º**æµè§ˆé‡æ•°å­—
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ— é”™è¯¯ï¼ˆæ—  API 404ï¼‰

### Vercel éƒ¨ç½²éªŒè¯

- [ ] Vercel é…ç½®ç¯å¢ƒå˜é‡
- [ ] Vercel è‡ªåŠ¨æ„å»ºæˆåŠŸ
- [ ] è®¿é—® `https://your-project.vercel.app/openeducation/`
- [ ] æ–‡ç« å†…å®¹æ­£å¸¸æ˜¾ç¤º
- [ ] é¡µé¢æ ·å¼æ­£å¸¸
- [ ] **æ˜¾ç¤º**æµè§ˆé‡æ•°å­—
- [ ] åˆ·æ–°é¡µé¢ï¼Œæµè§ˆé‡å¢åŠ 
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ— é”™è¯¯

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šGitHub Pages ä»æ˜¾ç¤ºç»Ÿè®¡ç»„ä»¶

**åŸå› **ï¼šç¯å¢ƒå˜é‡æœªæ­£ç¡®ä¼ é€’

**æ£€æŸ¥**ï¼š
```yaml
# .github/workflows/deploy.yml
env:
  PUBLIC_ENABLE_SUPABASE: 'false'  # ç¡®ä¿æ˜¯å­—ç¬¦ä¸² 'false'
```

**è§£å†³**ï¼šç¡®ä¿å€¼ç”¨å¼•å·åŒ…è£¹

---

### é—®é¢˜ 2ï¼šVercel ä¸æ˜¾ç¤ºç»Ÿè®¡

**åŸå› **ï¼šç¯å¢ƒå˜é‡æœªé…ç½®

**æ£€æŸ¥**ï¼šVercel Dashboard â†’ Settings â†’ Environment Variables

**è§£å†³**ï¼šæ·»åŠ ä»¥ä¸‹å˜é‡ï¼š
```
PUBLIC_ENABLE_SUPABASE=true
PUBLIC_SUPABASE_URL=...
PUBLIC_SUPABASE_ANON_KEY=...
```

---

### é—®é¢˜ 3ï¼šæœ¬åœ°å¼€å‘æ— ç»Ÿè®¡

**åŸå› **ï¼š`.env` æ–‡ä»¶é…ç½®é”™è¯¯

**æ£€æŸ¥**ï¼š
```bash
# .env æ–‡ä»¶å†…å®¹
PUBLIC_ENABLE_SUPABASE=true  # ç¡®ä¿æ˜¯ true
```

**è§£å†³**ï¼š
1. ç¡®ä¿ `.env` æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•
2. é‡å¯å¼€å‘æœåŠ¡å™¨

---

### é—®é¢˜ 4ï¼šGitHub Pages å‡ºç° API 404 é”™è¯¯

**åŸå› **ï¼šç»Ÿè®¡è„šæœ¬ä»åœ¨æ‰§è¡Œ

**æ£€æŸ¥**ï¼šæµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ `/api/stats` 404 é”™è¯¯

**è§£å†³**ï¼š
1. ç¡®è®¤ `PUBLIC_ENABLE_SUPABASE: 'false'`
2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
3. é‡æ–°éƒ¨ç½²

---

## ğŸ“Š æ„å»ºæµç¨‹å¯¹æ¯”

### GitHub Pages æ„å»ºæµç¨‹

```
æ¨é€ä»£ç åˆ° GitHub
    â†“
è§¦å‘ GitHub Actions
    â†“
è®¾ç½®ç¯å¢ƒå˜é‡ï¼šPUBLIC_ENABLE_SUPABASE='false'
    â†“
è¿è¡Œï¼šnpm run build:github
    â†“
ä½¿ç”¨ï¼šastro.config.static.tsï¼ˆstatic æ¨¡å¼ï¼‰
    â†“
ç”Ÿæˆï¼šdist/ ç›®å½•ï¼ˆçº¯é™æ€ HTMLï¼‰
    â†“
éƒ¨ç½²åˆ° GitHub Pages
    â†“
ç»“æœï¼šæ—  Supabase åŠŸèƒ½çš„é™æ€ç½‘ç«™
```

---

### Vercel æ„å»ºæµç¨‹

```
æ¨é€ä»£ç åˆ° GitHub
    â†“
Vercel è‡ªåŠ¨æ£€æµ‹
    â†“
è¯»å–ç¯å¢ƒå˜é‡ï¼šPUBLIC_ENABLE_SUPABASE=true
    â†“
è¿è¡Œï¼šnpm run build:vercel
    â†“
ä½¿ç”¨ï¼šastro.config.tsï¼ˆserver æ¨¡å¼ + Vercel adapterï¼‰
    â†“
ç”Ÿæˆï¼š.vercel/output/ï¼ˆSSR è¾“å‡ºï¼‰
    â†“
éƒ¨ç½²åˆ° Vercel
    â†“
ç»“æœï¼šå®Œæ•´åŠŸèƒ½çš„åŠ¨æ€ç½‘ç«™
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ç¯å¢ƒå˜é‡å‘½å

- âœ… ä½¿ç”¨ `PUBLIC_` å‰ç¼€ï¼ˆAstro è¦æ±‚ï¼‰
- âœ… ä½¿ç”¨æè¿°æ€§åç§°
- âœ… ä½¿ç”¨å­—ç¬¦ä¸² `'true'`/`'false'`ï¼ˆé¿å…å¸ƒå°”å€¼é—®é¢˜ï¼‰

### 2. åŠŸèƒ½é™çº§

- âœ… ç¦ç”¨åŠŸèƒ½æ—¶ä¸æ˜¾ç¤ºä»»ä½• UIï¼ˆé¿å…æ··æ·†ï¼‰
- âœ… ä¸è°ƒç”¨ä¸å­˜åœ¨çš„ APIï¼ˆé¿å… 404 é”™è¯¯ï¼‰
- âœ… æä¾›ä¼˜é›…çš„é™çº§ä½“éªŒ

### 3. æ—¥å¿—è®°å½•

```typescript
// åœ¨è„šæœ¬ä¸­æ·»åŠ æ—¥å¿—
if (!enableSupabase) {
  console.log('[Info] é™æ€æ¨¡å¼ï¼ŒSupabase åŠŸèƒ½å·²ç¦ç”¨');
}
```

### 4. æ–‡æ¡£ç»´æŠ¤

- âœ… æ›´æ–° README
- âœ… è®°å½•ç¯å¢ƒå˜é‡
- âœ… æä¾›ç¤ºä¾‹é…ç½®

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒæœºåˆ¶

```
ç¯å¢ƒå˜é‡ï¼šPUBLIC_ENABLE_SUPABASE
    â”œâ”€ 'true'  â†’ å¯ç”¨ Supabaseï¼ˆVercelï¼‰
    â””â”€ 'false' â†’ ç¦ç”¨ Supabaseï¼ˆGitHub Pagesï¼‰

å®ç°æ–¹å¼ï¼š
    â”œâ”€ ç»„ä»¶çº§åˆ«ï¼šæ¡ä»¶æ¸²æŸ“
    â”œâ”€ è„šæœ¬çº§åˆ«ï¼šæ¡ä»¶æ‰§è¡Œ
    â””â”€ é¡µé¢çº§åˆ«ï¼šæ¡ä»¶æ³¨å…¥
```

### ä¼˜åŠ¿

- âœ… åŒä¸€ä»½ä»£ç ï¼Œå¤šç¯å¢ƒéƒ¨ç½²
- âœ… è‡ªåŠ¨æ ¹æ®ç¯å¢ƒåˆ‡æ¢åŠŸèƒ½
- âœ… æ— éœ€æ‰‹åŠ¨ä¿®æ”¹ä»£ç 
- âœ… æ˜“äºç»´æŠ¤å’Œæ‰©å±•

### è®¿é—®æ–¹å¼

**GitHub Pages**ï¼ˆçº¯é™æ€ï¼‰ï¼š
```
https://xujinhuana.github.io/openeducation/
```

**Vercel**ï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰ï¼š
```
https://your-project.vercel.app/openeducation/
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `.env.example` - ç¯å¢ƒå˜é‡ç¤ºä¾‹
- `astro.config.ts` - Vercel é…ç½®
- `astro.config.static.ts` - GitHub Pages é…ç½®
- `SSRè¯¦è§£.md` - SSR æ¦‚å¿µè¯´æ˜
- `éƒ¨ç½²ç»ˆææ–¹æ¡ˆ.md` - éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”

---

**ç°åœ¨ä½ å¯ä»¥åŒæ—¶ä½¿ç”¨ä¸¤ä¸ªéƒ¨ç½²å¹³å°äº†ï¼** ğŸ‰

- GitHub Pagesï¼šå†…å®¹å±•ç¤ºï¼ˆå…è´¹ã€ç¨³å®šï¼‰
- Vercelï¼šå®Œæ•´ä½“éªŒï¼ˆå…è´¹ã€åŠŸèƒ½é½å…¨ï¼‰

ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©è®¿é—®å“ªä¸ªç‰ˆæœ¬ï¼

