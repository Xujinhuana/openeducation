# ğŸš¨ éƒ¨ç½²é”™è¯¯å¿«é€Ÿä¿®å¤æŒ‡ä»¤

## é—®é¢˜æè¿°

- **GitHub Actions æŠ¥é”™**ï¼š`Invalid action input 'build'` å’Œ `EEXIST: file already exists`
- **Vercel éƒ¨ç½²æŠ¥é”™**ï¼š`EEXIST: file already exists, mkdir '.vercel/output/server/'`

## ğŸ”§ ç«‹å³æ‰§è¡Œçš„ä¿®å¤æ­¥éª¤

### æ­¥éª¤ 1ï¼šæ£€æŸ¥å¹¶æ¸…ç† .vercel ç›®å½•

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd F:/IOTO-Doc/AstrOb

# æ£€æŸ¥ .vercel ç›®å½•æ˜¯å¦è¢« Git è¿½è¸ª
git ls-files | grep .vercel

# å¦‚æœæœ‰è¾“å‡ºï¼Œè¯´æ˜è¢«è¿½è¸ªäº†ï¼Œéœ€è¦åˆ é™¤
git rm -r --cached .vercel

# æäº¤æ›´æ”¹
git commit -m "chore: remove .vercel directory from git tracking"
```

### æ­¥éª¤ 2ï¼šç¡®è®¤é…ç½®æ–‡ä»¶å·²æ›´æ–°

âœ… **å·²å®Œæˆçš„ä¿®æ”¹**ï¼ˆæˆ‘å·²ç»å¸®ä½ å®Œæˆäº†ï¼‰ï¼š

1. **`.gitignore`** - å·²æ·»åŠ  `.vercel/` å¿½ç•¥è§„åˆ™
2. **`.github/workflows/deploy.yml`** - å·²ä¿®å¤ GitHub Actions é…ç½®
3. **`æ„å»ºé…ç½®è¯´æ˜.md`** - å·²æ›´æ–°æ–‡æ¡£è¯´æ˜

### æ­¥éª¤ 3ï¼šæ¨é€ä¿®å¤åˆ° GitHub

```bash
# æ·»åŠ æ‰€æœ‰æ›´æ”¹
git add .

# æäº¤æ›´æ”¹
git commit -m "fix: resolve deployment errors for GitHub and Vercel"

# æ¨é€åˆ° GitHub
git push origin main
```

### æ­¥éª¤ 4ï¼šéªŒè¯ Vercel é…ç½®

ç¡®è®¤ `vercel.json` ä½¿ç”¨æ­£ç¡®çš„æ„å»ºå‘½ä»¤ï¼š

```json
{
  "buildCommand": "npm run build:vercel",
  "outputDirectory": ".vercel/output",
  "framework": "astro"
}
```

å¦‚æœ Vercel è¿˜æœ‰é—®é¢˜ï¼Œåœ¨ Vercel Dashboard ä¸­ï¼š
1. è¿›å…¥é¡¹ç›®è®¾ç½®
2. **General** â†’ **Build & Development Settings**
3. ç‚¹å‡» **Override** å¼€å…³
4. **Build Command**: `npm run build:vercel`
5. **Output Directory**: `.vercel/output`
6. ä¿å­˜è®¾ç½®å¹¶é‡æ–°éƒ¨ç½²

---

## ğŸ“‹ éªŒè¯æ¸…å•

å®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] `.gitignore` æ–‡ä»¶åŒ…å« `.vercel/` è¡Œ
- [ ] è¿è¡Œ `git ls-files | grep .vercel` æ— è¾“å‡ºï¼ˆç¡®è®¤æœªè¢«è¿½è¸ªï¼‰
- [ ] `.github/workflows/deploy.yml` ä½¿ç”¨æ–°çš„ Node.js æ„å»ºæ­¥éª¤
- [ ] æœ¬åœ°æµ‹è¯• `npm run build:github` æˆåŠŸç”Ÿæˆ `dist/` ç›®å½•
- [ ] æœ¬åœ°æµ‹è¯• `npm run build:vercel` æˆåŠŸç”Ÿæˆ `.vercel/output/` ç›®å½•
- [ ] æ¨é€ä»£ç åˆ° GitHub åï¼ŒActions æ„å»ºæˆåŠŸ
- [ ] Vercel è‡ªåŠ¨éƒ¨ç½²æˆåŠŸ

---

## ğŸ¯ ä¿®å¤åŸç†

### ä¸ºä»€ä¹ˆä¼šå‡ºç° EEXIST é”™è¯¯ï¼Ÿ

1. **æ ¹æœ¬åŸå› **ï¼š`.vercel` ç›®å½•è¢«æäº¤åˆ° Git ä»“åº“
2. **å†²çªåœºæ™¯**ï¼š
   - GitHub Actions è¿è¡Œæ—¶ï¼Œæ£€å‡ºä»£ç åŒ…å«äº† `.vercel` ç›®å½•
   - ä½¿ç”¨ `astro.config.ts`ï¼ˆserver æ¨¡å¼ï¼‰ä¼šå°è¯•åˆ›å»º `.vercel/output/server/`
   - ä½†è¯¥ç›®å½•å·²å­˜åœ¨ï¼Œå¯¼è‡´ `EEXIST` é”™è¯¯

### ä¸ºä»€ä¹ˆä¼šå‡ºç° Invalid action input é”™è¯¯ï¼Ÿ

1. **æ ¹æœ¬åŸå› **ï¼š`withastro/action@v2` ä¸æ”¯æŒ `build` å‚æ•°
2. **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨æ ‡å‡† Node.js æ„å»ºæµç¨‹
   - æ‰‹åŠ¨å®‰è£…ä¾èµ–ï¼ˆ`npm ci`ï¼‰
   - æ‰‹åŠ¨è¿è¡Œæ„å»ºå‘½ä»¤ï¼ˆ`npm run build:github`ï¼‰
   - æ‰‹åŠ¨ä¸Šä¼ æ„å»ºäº§ç‰©ï¼ˆ`actions/upload-pages-artifact@v3`ï¼‰

---

## ğŸš€ éƒ¨ç½²ç›®æ ‡é…ç½®æ€»ç»“

| éƒ¨ç½²å¹³å° | æ„å»ºå‘½ä»¤ | é…ç½®æ–‡ä»¶ | æ¨¡å¼ | è¾“å‡ºç›®å½• | åŠŸèƒ½ |
|---------|---------|---------|------|---------|------|
| **GitHub Pages** | `npm run build:github` | `astro.config.static.ts` | `static` | `dist/` | ä»…é™æ€ |
| **Vercel** | `npm run build:vercel` | `astro.config.ts` | `server` | `.vercel/output/` | å®Œæ•´ SSR |

---

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

1. **å§‹ç»ˆå¿½ç•¥æ„å»ºäº§ç‰©**
   ```gitignore
   dist/
   .astro/
   .vercel/
   ```

2. **æ˜ç¡®åˆ†ç¦»é…ç½®**
   - GitHub Pages â†’ é™æ€é…ç½®ï¼ˆ`astro.config.static.ts`ï¼‰
   - Vercel â†’ æœåŠ¡å™¨é…ç½®ï¼ˆ`astro.config.ts`ï¼‰

3. **æœ¬åœ°æµ‹è¯•ä¼˜å…ˆ**
   ```bash
   # æµ‹è¯• GitHub Pages æ„å»º
   npm run build:github
   
   # æµ‹è¯• Vercel æ„å»º
   npm run build:vercel
   ```

4. **ä¼˜å…ˆä½¿ç”¨ Vercel**
   - æ”¯æŒå®Œæ•´çš„ SSR å’Œ API è·¯ç”±
   - æ”¯æŒ Supabase ç­‰åŠ¨æ€åŠŸèƒ½
   - æ›´å¥½çš„æ€§èƒ½å’Œå¼€å‘ä½“éªŒ

---

## ğŸ“ å¦‚æœä»æœ‰é—®é¢˜

### GitHub Actions æŒç»­å¤±è´¥

1. æ£€æŸ¥ Actions æ—¥å¿—ä¸­çš„å…·ä½“é”™è¯¯ä¿¡æ¯
2. ç¡®è®¤ `node-version: 22` ä¸ `package.json` è¦æ±‚åŒ¹é…
3. ç¡®è®¤ `dist/` ç›®å½•åœ¨æ„å»ºåå­˜åœ¨
4. å°è¯•åœ¨ GitHub Actions ä¸­æ·»åŠ è°ƒè¯•æ­¥éª¤ï¼š
   ```yaml
   - name: Debug - List files
     run: ls -la
   ```

### Vercel éƒ¨ç½²æŒç»­å¤±è´¥

1. åœ¨ Vercel Dashboard æŸ¥çœ‹è¯¦ç»†æ„å»ºæ—¥å¿—
2. ç¡®è®¤ç¯å¢ƒå˜é‡å·²æ­£ç¡®é…ç½®ï¼ˆå¦‚æœä½¿ç”¨ Supabaseï¼‰
3. å°è¯•æ‰‹åŠ¨è§¦å‘é‡æ–°éƒ¨ç½²
4. æ£€æŸ¥ `.vercel/output/` æ˜¯å¦è¢« `.gitignore` å¿½ç•¥

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `æ„å»ºé…ç½®è¯´æ˜.md` - è¯¦ç»†çš„æ„å»ºé…ç½®è¯´æ˜
- `éƒ¨ç½²è¯´æ˜.md` - éƒ¨ç½²å¹³å°é…ç½®æŒ‡å—
- `README.md` - é¡¹ç›®æ€»è§ˆ

---

**åˆ›å»ºæ—¶é—´**ï¼š2025-10-23  
**çŠ¶æ€**ï¼šâœ… é…ç½®æ–‡ä»¶å·²ä¿®å¤ï¼Œç­‰å¾…æ¨é€éªŒè¯

