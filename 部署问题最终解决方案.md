# ğŸ”§ éƒ¨ç½²é—®é¢˜æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

## ğŸ¯ é—®é¢˜æ€»ç»“

### é—®é¢˜ 1ï¼šGitHub Actions - "No adapter installed"
**é”™è¯¯**ï¼š
```
[NoAdapterInstalled] Cannot use server-rendered pages without an adapter.
```

**æ ¹æœ¬åŸå› **ï¼š
`astro-spaceship` integration å¼ºåˆ¶ä½¿ç”¨ `server` æ¨¡å¼ï¼Œå³ä½¿åœ¨ `astro.config.static.ts` ä¸­è®¾ç½®äº† `output: 'static'`ã€‚

---

### é—®é¢˜ 2ï¼šVercel - "EEXIST: file already exists"
**é”™è¯¯**ï¼š
```
EEXIST: file already exists, mkdir '/vercel/path0/.vercel/output/server/'
```

**æ ¹æœ¬åŸå› **ï¼š
Vercel æ„å»ºç¼“å­˜å¯¼è‡´ `.vercel/output/server/` ç›®å½•å·²å­˜åœ¨ï¼Œå†æ¬¡åˆ›å»ºæ—¶å†²çªã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆ

### è§£å†³æ–¹æ¡ˆ 1ï¼šä¿®å¤ GitHub Actions é™æ€æ„å»º

**ä¿®æ”¹ `astro.config.static.ts`**ï¼š

âŒ **ä¹‹å‰ï¼ˆé”™è¯¯ï¼‰**ï¼š
```typescript
import { astroSpaceship } from 'astro-spaceship';

export default defineConfig({
  output: 'static',
  integrations: [
    astroSpaceship(websiteConfig)  // â† å¼ºåˆ¶ä½¿ç”¨ server æ¨¡å¼
  ]
});
```

âœ… **ç°åœ¨ï¼ˆæ­£ç¡®ï¼‰**ï¼š
```typescript
// ä¸å¯¼å…¥ astro-spaceship
export default defineConfig({
  output: 'static',
  integrations: [],  // â† ç©ºæ•°ç»„ï¼Œçº¯é™æ€æ„å»º
});
```

**ä¸ºä»€ä¹ˆ**ï¼š
`astro-spaceship` integration å†…éƒ¨å¯èƒ½å¼ºåˆ¶ä½¿ç”¨ `server` æ¨¡å¼ä»¥æ”¯æŒæŸäº›åŠ¨æ€åŠŸèƒ½ã€‚å¯¹äº GitHub Pages çº¯é™æ€æ„å»ºï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿™ä¸ª integrationã€‚

---

### è§£å†³æ–¹æ¡ˆ 2ï¼šä¿®å¤ Vercel æ„å»ºç¼“å­˜

**ä¿®æ”¹ `vercel.json`**ï¼š

âŒ **ä¹‹å‰**ï¼š
```json
{
  "buildCommand": "npm run build:vercel"
}
```

âœ… **ç°åœ¨**ï¼š
```json
{
  "buildCommand": "rm -rf .vercel && npm run build:vercel"
}
```

**ä¸ºä»€ä¹ˆ**ï¼š
åœ¨æ„å»ºå‰æ¸…é™¤æ—§çš„ `.vercel` ç›®å½•ï¼Œé¿å…ç¼“å­˜å†²çªã€‚

---

## ğŸ“Š æœ€ç»ˆé…ç½®å¯¹æ¯”

### Vercel éƒ¨ç½²ï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| **é…ç½®æ–‡ä»¶** | `astro.config.ts` |
| **æ¨¡å¼** | `server` |
| **Adapter** | `@astrojs/vercel` |
| **Integrations** | `astroSpaceship(websiteConfig)` |
| **æ„å»ºå‘½ä»¤** | `rm -rf .vercel && npm run build:vercel` |
| **è¾“å‡ºç›®å½•** | `.vercel/output/` |
| **åŠŸèƒ½** | âœ… å®Œæ•´ Supabase åŠŸèƒ½ |

---

### GitHub Pages éƒ¨ç½²ï¼ˆé™æ€ï¼‰

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| **é…ç½®æ–‡ä»¶** | `astro.config.static.ts` |
| **æ¨¡å¼** | `static` |
| **Adapter** | æ—  |
| **Integrations** | `[]` (ç©ºæ•°ç»„) |
| **æ„å»ºå‘½ä»¤** | `npm run build:github` |
| **è¾“å‡ºç›®å½•** | `dist/` |
| **åŠŸèƒ½** | âŒ æ— åŠ¨æ€åŠŸèƒ½ï¼ˆçº¯é™æ€ï¼‰ |

---

## ğŸ¯ æ¶æ„è¯´æ˜

### ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Ÿ

```
å¼€å‘ç¯å¢ƒï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰
â”œâ”€ é…ç½®ï¼šastro.config.ts
â”œâ”€ æ¨¡å¼ï¼šserver
â”œâ”€ Integrationï¼šastro-spaceship
â””â”€ åŠŸèƒ½ï¼šå®Œæ•´çš„ Supabase åŠŸèƒ½

Vercel éƒ¨ç½²ï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰
â”œâ”€ é…ç½®ï¼šastro.config.ts
â”œâ”€ æ¨¡å¼ï¼šserver + Vercel adapter
â”œâ”€ Integrationï¼šastro-spaceship
â””â”€ åŠŸèƒ½ï¼šå®Œæ•´çš„ Supabase åŠŸèƒ½

GitHub Pages éƒ¨ç½²ï¼ˆçº¯é™æ€ï¼‰
â”œâ”€ é…ç½®ï¼šastro.config.static.ts
â”œâ”€ æ¨¡å¼ï¼šstatic
â”œâ”€ Integrationï¼šæ— ï¼ˆç§»é™¤ astro-spaceshipï¼‰
â””â”€ åŠŸèƒ½ï¼šä»…é™æ€å†…å®¹
```

---

## ğŸ“‹ å®Œæ•´æ–‡ä»¶å†…å®¹

### `astro.config.ts` (Vercel + å¼€å‘)

```typescript
import { defineConfig } from 'astro/config';
import { astroSpaceship } from 'astro-spaceship';
import vercel from '@astrojs/vercel/serverless';
import websiteConfig from 'astro-spaceship/config';

export default defineConfig({
  output: 'server',
  adapter: vercel(),
  integrations: [
    astroSpaceship(websiteConfig)
  ],
  devToolbar: {
    enabled: false
  },
  site: process.env.SPACESHIP_SITE || 'http://localhost:4321',
  base: process.env.SPACESHIP_BASE || '/openeducation/'
});
```

---

### `astro.config.static.ts` (GitHub Pages)

```typescript
import { defineConfig } from 'astro/config';

// é™æ€æ„å»ºé…ç½®ï¼ˆç”¨äº GitHub Pagesï¼‰
// ä¸ä½¿ç”¨ astro-spaceshipï¼Œé¿å…å¼ºåˆ¶ server æ¨¡å¼
export default defineConfig({
  output: 'static',
  integrations: [],  // ç©ºæ•°ç»„
  devToolbar: {
    enabled: false
  },
  site: process.env.SPACESHIP_SITE || 'http://localhost:4321',
  base: process.env.SPACESHIP_BASE || '/openeducation/'
});
```

---

### `vercel.json`

```json
{
  "buildCommand": "rm -rf .vercel && npm run build:vercel",
  "outputDirectory": ".vercel/output",
  "framework": "astro",
  "devCommand": "npm run dev",
  "installCommand": "npm install",
  "cleanUrls": true,
  "trailingSlash": false
}
```

---

### `.github/workflows/deploy.yml`

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout your repository using git
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build with Astro (Static for GitHub Pages)
        run: npm run build:github
        env:
          SPACESHIP_SITE: https://xujinhuana.github.io
          SPACESHIP_BASE: /openeducation/
          SPACESHIP_AUTHOR: My Vault
      
      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./dist

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

---

### `.gitignore`

```gitignore
# build output
dist/
# generated types
.astro/

# dependencies
node_modules/

# vercel
.vercel/  # â† å¿…é¡»å¿½ç•¥

# logs
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*

# environment variables
.env
.env.production

# macOS-specific files
.DS_Store
```

---

## âœ… éªŒè¯æ­¥éª¤

### 1. æœ¬åœ°æµ‹è¯•

```bash
# æ¸…ç†æ—§çš„æ„å»º
rm -rf dist .vercel .astro

# æµ‹è¯• GitHub Pages æ„å»ºï¼ˆé™æ€ï¼‰
npm run build:github
# åº”è¯¥æˆåŠŸï¼Œç”Ÿæˆ dist/ ç›®å½•

# æµ‹è¯• Vercel æ„å»ºï¼ˆserver + adapterï¼‰
npm run build:vercel
# åº”è¯¥æˆåŠŸï¼Œç”Ÿæˆ .vercel/output/ ç›®å½•
```

---

### 2. æäº¤å¹¶æ¨é€

```bash
git add .
git commit -m "fix: ä¿®å¤éƒ¨ç½²é…ç½® - ç§»é™¤é™æ€æ„å»ºä¸­çš„ astro-spaceshipï¼Œæ¸…é™¤ Vercel ç¼“å­˜"
git push origin main
```

---

### 3. éªŒè¯éƒ¨ç½²

**GitHub Actions**ï¼š
- è®¿é—® GitHub Actions æ ‡ç­¾
- æŸ¥çœ‹æœ€æ–°çš„ workflow è¿è¡Œ
- åº”è¯¥æˆåŠŸæ„å»º

**Vercel**ï¼š
- è®¿é—® Vercel Dashboard
- æŸ¥çœ‹æœ€æ–°çš„éƒ¨ç½²
- åº”è¯¥æˆåŠŸæ„å»º

---

## ğŸ‰ æˆåŠŸæ ‡å¿—

### GitHub Pages æˆåŠŸ
```
âœ… Build completed
âœ… Generated dist/ directory
âœ… Deploy to GitHub Pages succeeded
âœ… ç½‘ç«™å¯è®¿é—®ï¼ˆé™æ€å†…å®¹ï¼‰
â„¹ï¸ Supabase åŠŸèƒ½ä¸å·¥ä½œï¼ˆé¢„æœŸè¡Œä¸ºï¼‰
```

### Vercel æˆåŠŸ
```
âœ… Build completed
âœ… Generated .vercel/output/ directory
âœ… Deploy succeeded
âœ… ç½‘ç«™å¯è®¿é—®
âœ… Supabase åŠŸèƒ½å®Œæ•´å·¥ä½œ
```

---

## ğŸ’¡ å…³é”®ç†è§£

### ä¸ºä»€ä¹ˆ GitHub Pages è¦ç§»é™¤ astro-spaceshipï¼Ÿ

1. **astro-spaceship å¯èƒ½å†…éƒ¨å¼ºåˆ¶ server æ¨¡å¼**
   - æŸäº› integration ä¼šè¦†ç›–ç”¨æˆ·çš„ `output` è®¾ç½®
   - å¯¼è‡´å³ä½¿è®¾ç½®äº† `static`ï¼Œä»ç„¶ä½¿ç”¨ `server`

2. **GitHub Pages åªéœ€è¦é™æ€ HTML**
   - ä¸éœ€è¦ astro-spaceship çš„åŠ¨æ€åŠŸèƒ½
   - ç§»é™¤åå¯ä»¥çº¯é™æ€æ„å»º

3. **Vercel ä¿ç•™ astro-spaceship**
   - Vercel æ”¯æŒ SSRï¼Œå¯ä»¥ä½¿ç”¨å®Œæ•´åŠŸèƒ½
   - ä¿ç•™ astro-spaceship ä»¥è·å¾—å®Œæ•´ä½“éªŒ

---

## ğŸ“š ç›¸å…³å‘½ä»¤

```bash
# æ¸…ç†æ‰€æœ‰æ„å»ºäº§ç‰©
rm -rf dist .vercel .astro node_modules/.astro

# æœ¬åœ°å¼€å‘ï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰
npm run dev

# GitHub Pages æ„å»º
npm run build:github

# Vercel æ„å»º
npm run build:vercel

# é¢„è§ˆæ„å»ºç»“æœ
npm run preview
```

---

## ğŸ†˜ å¦‚æœè¿˜æ˜¯å¤±è´¥

### è°ƒè¯•æ­¥éª¤

1. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**
   ```bash
   npm run build:github -- --verbose
   npm run build:vercel -- --verbose
   ```

2. **æ£€æŸ¥é…ç½®**
   ```bash
   # ç¡®è®¤ä½¿ç”¨çš„é…ç½®æ–‡ä»¶
   grep -r "output:" astro.config*.ts
   ```

3. **æ¸…ç†æ‰€æœ‰ç¼“å­˜**
   ```bash
   rm -rf dist .vercel .astro node_modules/.astro
   npm ci
   ```

4. **Vercel æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜**
   - Vercel Dashboard â†’ Settings â†’ Data â†’ Clear Cache

---

**ç°åœ¨åº”è¯¥å¯ä»¥æˆåŠŸéƒ¨ç½²äº†ï¼** ğŸš€

